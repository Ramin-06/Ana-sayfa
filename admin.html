<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Panel - Firestore modular</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    label, input, button { display: block; margin: 10px 0; }
    table { border-collapse: collapse; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; }
  </style>
</head>
<body>

  <h1>Admin Panel</h1>

  <form id="productForm">
    <label>Kod:</label>
    <input id="code" type="text" required placeholder="P0001" />
    <label>Ad:</label>
    <input id="name" type="text" required placeholder="Məhsul adı" />
    <label>Qiymət:</label>
    <input id="price" type="number" required placeholder="Qiymət" />
    <button type="submit">Əlavə et</button>
  </form>

  <h2>Məhsullar</h2>
  <table>
    <thead><tr><th>Kod</th><th>Ad</th><th>Qiymət</th><th>Sil</th></tr></thead>
    <tbody id="productsList"></tbody>
  </table>

  <!-- Firebase SDKs -->
  <script type="module">
    // Importlar (modular Firebase 9+)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB9Kk69OTLmYfAFt69rK2WB5GTeHw1oejk",
      authDomain: "etirsayti.firebaseapp.com",
      projectId: "etirsayti",
      storageBucket: "etirsayti.appspot.com",
      messagingSenderId: "15600931485",
      appId: "1:15600931485:web:a5c212bfe04fb7556d7a74"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsCol = collection(db, "products");

    const form = document.getElementById("productForm");
    const productsList = document.getElementById("productsList");

    // Məhsulları ekrana yazdırırıq
    async function loadProducts() {
      productsList.innerHTML = "";
      const snapshot = await getDocs(productsCol);
      snapshot.forEach(docSnap => {
        const p = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.price}</td>
          <td><button data-id="${docSnap.id}">Sil</button></td>
        `;
        productsList.appendChild(tr);
      });
      // Sil düymələrinə dinamik event əlavə edirik
      productsList.querySelectorAll("button").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.getAttribute("data-id");
          await deleteDoc(doc(db, "products", id));
          loadProducts();
        };
      });
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const code = form.code.value.trim();
      const name = form.name.value.trim();
      const price = form.price.value.trim();

      if (!code || !name || !price) {
        alert("Bütün sahələri doldurun!");
        return;
      }

      try {
        await addDoc(productsCol, { code, name, price });
        form.reset();
        loadProducts();
      } catch (err) {
        alert("Xəta: " + err.message);
      }
    });

    loadProducts();
  </script>

</body>
</html>
