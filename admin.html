<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Panel</title>
  <style>
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>Məhsul Əlavə Et</h1>
  <form id="productForm">
    <input type="text" id="kod" placeholder="Məhsul kodu" required /> <br />
    <input type="text" id="ad" placeholder="Məhsul adı" required /> <br />
    <select id="olcu">
      <option value="30ml">30ml</option>
      <option value="50ml">50ml</option>
    </select> <br />
    <input type="number" id="qiymet" placeholder="Qiymət" required /> <br />
    <textarea id="melumat" placeholder="Məhsul məlumatı" required></textarea> <br />
    <button type="submit">Əlavə et</button>
    <button type="button" id="cancelUpdate" style="display:none">Ləğv et</button>
  </form>

  <table id="productsTable">
    <thead>
      <tr>
        <th>Kod</th><th>Ad</th><th>Ölçü</th><th>Qiymət</th><th>Məlumat</th><th>Əməliyyat</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productsRef = collection(db, "products");

    const form = document.getElementById("productForm");
    const tableBody = document.querySelector("#productsTable tbody");
    const cancelUpdateBtn = document.getElementById("cancelUpdate");

    let editId = null;

    const renderTable = async () => {
      tableBody.innerHTML = "";
      const snapshot = await getDocs(productsRef);
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${data.kod}</td>
          <td>${data.ad}</td>
          <td>${data.olcu}</td>
          <td>${data.qiymet}</td>
          <td>${data.melumat}</td>
          <td>
            <button onclick="editProduct('${docSnap.id}', '${data.kod}', '${data.ad}', '${data.olcu}', ${data.qiymet}, \`${data.melumat}\`)" >Düzəliş et</button>
            <button onclick="deleteProduct('${docSnap.id}')">Sil</button>
          </td>
        `;
        tableBody.appendChild(tr);
      });
    };

    window.editProduct = (id, kod, ad, olcu, qiymet, melumat) => {
      document.getElementById("kod").value = kod;
      document.getElementById("ad").value = ad;
      document.getElementById("olcu").value = olcu;
      document.getElementById("qiymet").value = qiymet;
      document.getElementById("melumat").value = melumat;
      editId = id;
      cancelUpdateBtn.style.display = "inline";
    };

    window.deleteProduct = async (id) => {
      if (confirm("Məhsulu silmək istədiyinizə əminsiniz?")) {
        await deleteDoc(doc(db, "products", id));
        renderTable();
      }
    };

    cancelUpdateBtn.addEventListener("click", () => {
      form.reset();
      editId = null;
      cancelUpdateBtn.style.display = "none";
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const kod = document.getElementById("kod").value.trim();
      const ad = document.getElementById("ad").value.trim();
      const olcu = document.getElementById("olcu").value;
      const qiymet = parseFloat(document.getElementById("qiymet").value);
      const melumat = document.getElementById("melumat").value.trim();

      if (editId) {
        await updateDoc(doc(db, "products", editId), { kod, ad, olcu, qiymet, melumat });
        editId = null;
        cancelUpdateBtn.style.display = "none";
      } else {
        await addDoc(productsRef, { kod, ad, olcu, qiymet, melumat });
      }

      form.reset();
      renderTable();
    });

    renderTable();
  </script>
</body>
</html>
