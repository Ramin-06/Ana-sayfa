<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R-Shoppingaz</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg-color: #f0f4f8;
      --text-color: #2c3e50;
      --primary: #1abc9c;
      --nav-bg: #002147;
      --nav-text: #ecf0f1;
      --nav-active: #1abc9c;
      --card-bg: #ffffff;
      --footer-bg: #002147;
      --nav-hover-bg: rgba(255, 255, 255, 0.2);
    }
    body.dark {
      --bg-color: #121212;
      --text-color: #eee;
      --primary: #0d6efd;
      --nav-bg: #002147;
      --nav-text: #ffffff;
      --nav-active: #0d6efd;
      --card-bg: #1e1e1e;
      --footer-bg: #002147;
      --nav-hover-bg: rgba(255, 255, 255, 0.1);
    }
    body {
      margin: 0;
      font-family: 'Montserrat', Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .top-space {
      height: 40px;
      background-color: #fff;
    }
    nav {
      background-color: var(--nav-bg);
      padding: 20px 0;
    }
    .nav-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    nav ul {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
    }
    nav ul li a {
      color: var(--nav-text);
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
      padding: 15px 12px;
      border-radius: 12px;
      transition: background-color 0.3s, color 0.3s;
      display: inline-block;
    }
    nav ul li a:hover {
      background-color: var(--nav-hover-bg);
    }
    nav ul li a.active {
      background-color: var(--nav-active);
      color: #ffffff;
    }
    .theme-toggle {
      background: var(--card-bg);
      color: var(--nav-text);
      border: 1px solid var(--nav-text);
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 8px;
      transition: background-color 0.3s, color 0.3s;
    }
    .theme-toggle:hover {
      background-color: var(--primary);
      color: #fff;
    }
    main {
      flex: 1;
    }
    .section {
      display: none;
      padding: 40px 20px;
      max-width: 1000px;
      margin: auto;
    }
    .section.active {
      display: block;
    }
    h2 {
      color: var(--primary);
      text-align: center;
      margin-bottom: 30px;
    }
    #about p {
      font-size: 18px;
      line-height: 1.8;
      color: var(--text-color);
      background-color: var(--card-bg);
      padding: 25px 30px;
      border-radius: 16px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.05);
      max-width: 900px;
      margin: 0 auto;
      text-align: justify;
      font-weight: 500;
      letter-spacing: 0.3px;
    }
    #product-list {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      margin-top: 30px;
    }
    .product-card {
      background-color: var(--card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
      padding: 15px;
    }
    .product-card:hover {
      transform: scale(1.02);
    }
    #contactForm {
      max-width: 600px;
      margin: auto;
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      color: var(--text-color);
    }
    #contactForm h2 {
      color: var(--primary);
      margin-bottom: 20px;
      text-align: center;
    }
    #contactForm label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
      margin-bottom: 5px;
    }
    #contactForm input,
    #contactForm textarea {
      width: 100%;
      padding: 10px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
      resize: vertical;
      font-family: inherit;
      font-size: 16px;
      color: var(--text-color);
      background-color: var(--bg-color);
      transition: background-color 0.3s, color 0.3s;
    }
    #contactForm input:focus,
    #contactForm textarea:focus {
      border-color: var(--primary);
      outline: none;
      background-color: var(--card-bg);
    }
    #contactForm button {
      margin-top: 20px;
      width: 100%;
      padding: 12px;
      background-color: var(--primary);
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
      font-size: 18px;
    }
    #contactForm button:hover {
      background-color: #149b85;
    }
    #successMessage {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      display: none;
    }
    footer {
      background-color: var(--footer-bg);
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: auto;
    }

    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background-color: var(--card-bg);
      padding: 20px 30px;
      border-radius: 12px;
      max-width: 500px;
      box-shadow: 0 0 20px rgba(0,0,0,0.2);
      color: var(--text-color);
      position: relative;
    }
    .modal-content h3 {
      margin-top: 0;
      color: var(--primary);
    }
    .modal-content p {
      margin: 15px 0;
    }
    .close-btn {
      position: absolute;
      top: 12px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      color: var(--text-color);
      cursor: pointer;
      user-select: none;
    }

    /* ✅ Modal içi düymələr üçün dizayn */
    .volume-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      padding: 8px 16px;
      margin: 10px 8px 0 0;
      transition: background-color 0.3s, transform 0.2s;
    }
    .volume-btn:hover {
      background-color: #149b85;
      transform: scale(1.05);
    }
    .volume-btn.active {
      background-color: #0e7c68;
    }
    #whatsappOrderBtn {
      background-color: #25D366;
      color: white;
      border: none;
      border-radius: 10px;
      font-weight: bold;
      padding: 12px 20px;
      margin-top: 20px;
      transition: background-color 0.3s, transform 0.2s;
      display: block;
      width: 100%;
      text-align: center;
    }
    #whatsappOrderBtn:hover {
      background-color: #1da851;
      transform: scale(1.03);
    }

    /* PDF Kataloq Bölməsi */
    #catalog {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
      background-color: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    #pdf-controls {
      text-align: center;
      margin-bottom: 15px;
    }
    #pdf-controls button {
      padding: 8px 14px;
      margin: 0 8px;
      font-weight: 600;
      border-radius: 6px;
      border: 1px solid var(--primary);
      background-color: white;
      color: var(--primary);
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }
    #pdf-controls button:hover {
      background-color: var(--primary);
      color: white;
    }
    #pdf-render {
      border: 1px solid #ccc;
      max-width: 100%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: block;
      margin: 0 auto;
      border-radius: 8px;
    }
    #page-info {
      margin-top: 8px;
      text-align: center;
      font-weight: 600;
      color: var(--text-color);
    }
  </style>
</head>
<body>
  <div class="top-space"></div>
  <nav>
    <div class="nav-container">
      <div class="logo">
        <img src="logo.png" alt="Logo" style="height: 60px;" />
      </div>
      <ul>
        <li><a id="nav-about" class="active" onclick="showSection('about')">Haqqımızda</a></li>
        <li><a id="nav-projects" onclick="showSection('projects')">Ətirlər</a></li>
        <li><a id="nav-catalog" onclick="showSection('catalog')">Kataloq</a></li>
        <li><a id="nav-contact" onclick="showSection('contact')">Əlaqə</a></li>
      </ul>
      <button id="themeToggle" class="theme-toggle" onclick="toggleTheme()">QARANLIQ MOD</button>
    </div>
  </nav>

  <main>
    <div id="about" class="section active">
      <h2>Haqqımızda</h2>
      <p>
        R-Shoppingaz komandası olaraq deluxe keyfiyyətdə olan ətirləri sizə təqdim edirik.
        Zövqünüzə uyğun olan ətirləri sifariş edə bilərsiniz. Parfümeriya sahəsində təcrübəli
        mütəxəssislər tərəfindən hazırlanan qarışımların qalıcı olmasına zəmanət verilir.
        Fransa və Türkiyənin premium ətir dünyasına dəvət edirik! Yüksək qalıcılıq, unikal
        qoxular və sərfəli seçimlərlə təravətinizi vurğulayın. Zövqünüzü tamamlayan ideal
        qoxunu bizimlə kəşf edin.
      </p>
    </div>

    <div id="projects" class="section">
      <h2>Ətirlər</h2>
      <div id="product-list"></div>
    </div>

    <!-- Yeni PDF kataloq bölməsi -->
    <div id="catalog" class="section">
      <h2>Kataloq</h2>
      <div id="pdf-controls">
        <button id="prevPage">Əvvəlki səhifə</button>
        <span>Səhifə: <span id="pageNum">0</span> / <span id="pageCount">0</span></span>
        <button id="nextPage">Növbəti səhifə</button>
      </div>
      <canvas id="pdf-render" width="600" height="800"></canvas>
      <div id="page-info"></div>
    </div>

    <div id="contact" class="section">
      <form id="contactForm" action="https://getform.io/f/bqomyqzb" method="POST">
        <h2>Bizə Yazın</h2>
        <label for="Ad">Ad:</label>
        <input id="Ad" type="text" name="Ad" required />
        <label for="Soyad">Soyad:</label>
        <input id="Soyad" type="text" name="Soyad" required />
        <label for="E-posta">E-poçt:</label>
        <input id="E-posta" type="email" name="E-posta" required />
        <label for="Telefon">Telefon Nömrəsi:</label>
        <input id="Telefon" type="tel" name="Telefon" />
        <label for="Mesaj">Məktubunuz:</label>
        <textarea id="Mesaj" name="Mesaj" rows="5" required></textarea>
        <button type="submit">Göndər</button>
        <p id="successMessage"></p>
      </form>
    </div>
  </main>

  <!-- Modal HTML -->
  <div id="productModal" class="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <h3 id="modalTitle"></h3>
      <p id="modalDescription"></p>
      <p><strong id="modalPrice"></strong></p>
    </div>
  </div>

  <footer>
    <p>© 2025 R-Shoppingaz. Bütün hüquqlar qorunur.</p>
  </footer>

  <!-- PDF.js kitabxanası -->
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCSaiU9DguIk47O8LPZ_Oa6StJgHbPqZ6I",
      authDomain: "perfume-8b7f7.firebaseapp.com",
      projectId: "perfume-8b7f7",
      storageBucket: "perfume-8b7f7.appspot.com",
      messagingSenderId: "899731999798",
      appId: "1:899731999798:web:750af78287f56d15d41c97"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function createProductCard(product) {
      const card = document.createElement('div');
      card.className = 'product-card';

      card.innerHTML = `
        <h3>${product.name}</h3>
        <p style="font-size: 14px; color: gray;">Kod: ${product.code || '-'}</p>
      `;

      card.addEventListener('click', () => openModal(product));

      return card;
    }

    async function loadProducts() {
      const productList = document.getElementById('product-list');
      productList.innerHTML = '';

      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        if (querySnapshot.empty) {
          productList.innerHTML = '<p style="text-align:center;">Məhsul tapılmadı</p>';
          return;
        }

        querySnapshot.forEach(docSnap => {
          const product = docSnap.data();
          productList.appendChild(createProductCard(product));
        });
      } catch (error) {
        console.error("Məhsullar yüklənərkən xəta:", error);
        productList.innerHTML = '<p style="color:red; text-align:center;">Məhsullar yüklənərkən xəta baş verdi</p>';
      }
    }

    // Modal funksiyaları

    function openModal(product) {
      const modalTitle = document.getElementById('modalTitle');
      const modalDescription = document.getElementById('modalDescription');
      const modalPrice = document.getElementById('modalPrice');

      modalTitle.textContent = product.name;
      modalDescription.innerHTML = product.description || '';

      let selectedVolume = '30 ml';
      let price = 10;

      const oldBtns = document.querySelectorAll('.volume-btn, #whatsappOrderBtn');
      oldBtns.forEach(el => el.remove());

      modalPrice.textContent = `Qiymət: ${price} ₼`;

      const btn30 = document.createElement('button');
      btn30.textContent = '30 ml';
      btn30.className = 'volume-btn active';

      const btn50 = document.createElement('button');
      btn50.textContent = '50 ml';
      btn50.className = 'volume-btn';

      btn30.onclick = () => {
        selectedVolume = '30 ml';
        price = 10;
        btn30.classList.add('active');
        btn50.classList.remove('active');
        modalPrice.textContent = `Qiymət: ${price} ₼`;
      };

      btn50.onclick = () => {
        selectedVolume = '50 ml';
        price = 13;
        btn50.classList.add('active');
        btn30.classList.remove('active');
        modalPrice.textContent = `Qiymət: ${price} ₼`;
      };

      modalPrice.parentNode.insertBefore(btn30, modalPrice.nextSibling);
      modalPrice.parentNode.insertBefore(btn50, modalPrice.nextSibling);

      // WhatsApp sifariş düyməsi
      const orderBtn = document.createElement('a');
      orderBtn.href = `https://wa.me/994552323252?text=Salam,%20Mən%20${encodeURIComponent(product.name)}%20(${selectedVolume})%20haqqında%20məlumat%20almaq%20istəyirəm.`;
      orderBtn.target = '_blank';
      orderBtn.id = 'whatsappOrderBtn';
      orderBtn.textContent = 'WhatsApp-dan sifariş et';

      // Həcmi dəyişəndə linki yenilə
      function updateOrderLink() {
        orderBtn.href = `https://wa.me/994552323252?text=Salam,%20Mən%20${encodeURIComponent(product.name)}%20(${selectedVolume})%20haqqında%20məlumat%20almaq%20istəyirəm.`;
      }

      btn30.addEventListener('click', () => {
        selectedVolume = '30 ml';
        price = 10;
        btn30.classList.add('active');
        btn50.classList.remove('active');
        modalPrice.textContent = `Qiymət: ${price} ₼`;
        updateOrderLink();
      });
      btn50.addEventListener('click', () => {
        selectedVolume = '50 ml';
        price = 13;
        btn50.classList.add('active');
        btn30.classList.remove('active');
        modalPrice.textContent = `Qiymət: ${price} ₼`;
        updateOrderLink();
      });

      modalPrice.parentNode.appendChild(orderBtn);

      document.getElementById('productModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('productModal').classList.remove('active');
    }

    // Tema dəyişdirilməsi
    function toggleTheme() {
      const body = document.body;
      body.classList.toggle('dark');
      const btn = document.getElementById('themeToggle');
      if (body.classList.contains('dark')) {
        btn.textContent = 'İŞIQLI MOD';
      } else {
        btn.textContent = 'QARANLIQ MOD';
      }
    }

    // Naviqasiya və Section göstərmə
    function showSection(id) {
      // Bütün sekmeleri gizlət
      document.querySelectorAll('.section').forEach(sec => {
        sec.classList.remove('active');
      });
      // Aktiv link dəyiş
      document.querySelectorAll('nav ul li a').forEach(a => {
        a.classList.remove('active');
      });
      // Göstəriləcək sekme aktiv et
      const section = document.getElementById(id);
      if(section) section.classList.add('active');
      // Navbar link aktiv et
      const activeLink = document.getElementById('nav-' + id);
      if(activeLink) activeLink.classList.add('active');
    }

    // Contact form göndərmə sonrası mesaj göstərmə
    document.getElementById('contactForm').addEventListener('submit', e => {
      const msg = document.getElementById('successMessage');
      msg.style.color = 'green';
      msg.textContent = 'Müraciətiniz uğurla göndərildi! Tezliklə sizinlə əlaqə saxlanılacaq.';
      setTimeout(() => {
        msg.textContent = '';
      }, 7000);
    });

    // PDF.js ilə PDF göstərmə funksiyaları

    const url = 'urunlerim/KATALOQUM.pdf';

    let pdfDoc = null,
      pageNum = 1,
      pageIsRendering = false,
      pageNumIsPending = null;

    const scale = 1.4,
      canvas = document.getElementById('pdf-render'),
      ctx = canvas.getContext('2d');

    // Səhifəni render et
    const renderPage = num => {
      pageIsRendering = true;

      // PDF səhifəsini al
      pdfDoc.getPage(num).then(page => {
        // Canvas ölçüsünü səhifənin ölçüsünə uyğun et
        const viewport = page.getViewport({ scale });
        canvas.height = viewport.height;
        canvas.width = viewport.width;

        const renderCtx = {
          canvasContext: ctx,
          viewport
        };

        page.render(renderCtx).promise.then(() => {
          pageIsRendering = false;

          if (pageNumIsPending !== null) {
            renderPage(pageNumIsPending);
            pageNumIsPending = null;
          }
        });

        // Səhifə nömrəsini göstər
        document.getElementById('pageNum').textContent = num;
        document.getElementById('pageCount').textContent = pdfDoc.numPages;
      });
    };

    // Render olunmamış səhifə varsa növbəyə qoy
    const queueRenderPage = num => {
      if (pageIsRendering) {
        pageNumIsPending = num;
      } else {
        renderPage(num);
      }
    };

    // Əvvəlki səhifə
    const showPrevPage = () => {
      if (pageNum <= 1) {
        return;
      }
      pageNum--;
      queueRenderPage(pageNum);
    };

    // Növbəti səhifə
    const showNextPage = () => {
      if (pageNum >= pdfDoc.numPages) {
        return;
      }
      pageNum++;
      queueRenderPage(pageNum);
    };

    // PDF sənədini yüklə
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';

    pdfjsLib.getDocument(url).promise.then(pdfDoc_ => {
      pdfDoc = pdfDoc_;
      document.getElementById('pageCount').textContent = pdfDoc.numPages;

      renderPage(pageNum);
    }).catch(err => {
      const div = document.getElementById('catalog');
      div.innerHTML = `<p style="color: red; text-align:center;">PDF sənədi yüklənərkən xəta baş verdi: ${err.message}</p>`;
    });

    // PDF səhifə düymələri üçün eventlər
    document.getElementById('prevPage').addEventListener('click', showPrevPage);
    document.getElementById('nextPage').addEventListener('click', showNextPage);

    // İlk məhsulları yüklə
    loadProducts();

  </script>
</body>
</html>
