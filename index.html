<!DOCTYPE html>
<html lang="az">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R-Shoppingaz</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0; background: #f0f4f8; color: #2c3e50;
      min-height: 100vh; display: flex; flex-direction: column;
    }
    nav {
      background: #002147; padding: 15px 20px;
      display: flex; align-items: center; justify-content: space-between;
    }
    nav ul {
      list-style: none; margin: 0; padding: 0; display: flex; gap: 20px;
    }
    nav ul li a {
      color: #ecf0f1; text-decoration: none; font-weight: 600;
      cursor: pointer; padding: 8px 15px; border-radius: 10px;
      transition: background-color 0.3s;
      user-select: none;
    }
    nav ul li a.active, nav ul li a:hover {
      background-color: #1abc9c; color: #fff;
    }
    main {
      flex-grow: 1; max-width: 1000px; margin: 40px auto; padding: 0 20px;
    }
    .section { display: none; }
    .section.active { display: block; }
    h2 { color: #1abc9c; text-align: center; }
    #pdf-render { border: 1px solid #ccc; display: block; margin: 20px auto; max-width: 100%; border-radius: 10px; }
    .pdf-controls { text-align: center; margin-bottom: 40px; }
    .pdf-controls button {
      padding: 10px 20px; margin: 0 10px; border: none; border-radius: 8px;
      background-color: #1abc9c; color: white; cursor: pointer; font-weight: 600;
      transition: background-color 0.3s;
    }
    .pdf-controls button:hover { background-color: #149b85; }
    #pageInfo { font-weight: 600; font-size: 18px; vertical-align: middle; margin-left: 10px; }
    #product-list {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 15px; margin-top: 30px;
    }
    .product-card {
      background: white; border-radius: 12px; padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1); cursor: pointer;
      transition: transform 0.15s ease-in-out;
    }
    .product-card:hover { transform: scale(1.05); }
    form label { font-weight: bold; margin-top: 15px; display: block; }
    form input, form textarea {
      width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc;
      box-sizing: border-box; font-family: inherit; font-size: 16px;
    }
    form button {
      margin-top: 20px; width: 100%; padding: 12px; background-color: #1abc9c;
      color: white; font-weight: bold; border: none; border-radius: 4px;
      cursor: pointer; font-size: 18px; transition: background-color 0.3s;
    }
    form button:hover { background-color: #149b85; }
    #successMessage { text-align: center; font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <nav>
    <div style="color:white; font-weight:bold; font-size:22px;">R-Shoppingaz</div>
    <ul>
      <li><a href="#" id="nav-about" class="active">Haqqımızda</a></li>
      <li><a href="#" id="nav-projects">Ətirlər</a></li>
      <li><a href="#" id="nav-catalog">Kataloq</a></li>
      <li><a href="#" id="nav-contact">Əlaqə</a></li>
    </ul>
  </nav>

  <main>
    <section id="about" class="section active">
      <h2>Haqqımızda</h2>
      <p style="max-width:700px; margin:auto; text-align:justify;">
        R-Shoppingaz komandası olaraq deluxe keyfiyyətdə olan ətirləri sizə təqdim edirik.
        Zövqünüzə uyğun olan ətirləri sifariş edə bilərsiniz. Parfümeriya sahəsində təcrübəli
        mütəxəssislər tərəfindən hazırlanan qarışımların qalıcı olmasına zəmanət verilir.
      </p>
    </section>

    <section id="projects" class="section">
      <h2>Ətirlər</h2>
      <div id="product-list"><p style="text-align:center;">Yüklənir...</p></div>
    </section>

    <section id="catalog" class="section">
      <h2>Kataloq</h2>
      <canvas id="pdf-render"></canvas>
      <div class="pdf-controls">
        <button id="prevPage">Əvvəlki</button>
        <button id="nextPage">Növbəti</button>
        <span id="pageInfo">Səhifə: <span id="pageNum">0</span> / <span id="pageCount">0</span></span>
      </div>
    </section>

    <section id="contact" class="section">
      <h2>Əlaqə</h2>
      <form id="contactForm" action="https://getform.io/f/bqomyqzb" method="POST">
        <label for="Ad">Ad:</label>
        <input id="Ad" name="Ad" required />
        <label for="Soyad">Soyad:</label>
        <input id="Soyad" name="Soyad" required />
        <label for="E-posta">E-poçt:</label>
        <input type="email" id="E-posta" name="E-posta" required />
        <label for="Telefon">Telefon:</label>
        <input id="Telefon" name="Telefon" />
        <label for="Mesaj">Məktubunuz:</label>
        <textarea id="Mesaj" name="Mesaj" rows="5" required></textarea>
        <button type="submit">Göndər</button>
        <p id="successMessage"></p>
      </form>
    </section>
  </main>

  <script type="module">
    // Navbar bölmə dəyişmə
    const sections = ['about', 'projects', 'catalog', 'contact'];
    sections.forEach(id => {
      document.getElementById('nav-' + id).addEventListener('click', e => {
        e.preventDefault();
        sections.forEach(sec => {
          document.getElementById(sec).classList.remove('active');
          document.getElementById('nav-' + sec).classList.remove('active');
        });
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-' + id).classList.add('active');
      });
    });

    // PDF.js kitabxanasını CDN-dən gətiririk
    import { getDocument } from "https://cdn.jsdelivr.net/npm/pdfjs-dist@3.9.179/build/pdf.min.js";

    const pdfUrl = 'urunlerim/KATALOQUM.pdf';
    const canvas = document.getElementById('pdf-render');
    const ctx = canvas.getContext('2d');
    let pdfDoc = null, pageNum = 1, pageCount = 0, pageRendering = false, pageNumPending = null;
    const scale = 1.5;

    function renderPage(num) {
      pageRendering = true;
      pdfDoc.getPage(num).then(page => {
        const viewport = page.getViewport({ scale });
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        const renderContext = { canvasContext: ctx, viewport: viewport };
        const renderTask = page.render(renderContext);
        renderTask.promise.then(() => {
          pageRendering = false;
          if(pageNumPending !== null){
            renderPage(pageNumPending);
            pageNumPending = null;
          }
        });
        document.getElementById('pageNum').textContent = num;
      });
    }
    function queueRenderPage(num) {
      if(pageRendering) {
        pageNumPending = num;
      } else {
        renderPage(num);
      }
    }

    document.getElementById('prevPage').addEventListener('click', () => {
      if(pageNum <= 1) return;
      pageNum--;
      queueRenderPage(pageNum);
    });
    document.getElementById('nextPage').addEventListener('click', () => {
      if(pageNum >= pageCount) return;
      pageNum++;
      queueRenderPage(pageNum);
    });

    getDocument(pdfUrl).promise.then(pdfDoc_ => {
      pdfDoc = pdfDoc_;
      pageCount = pdfDoc.numPages;
      document.getElementById('pageCount').textContent = pageCount;
      renderPage(pageNum);
    }).catch(err => {
      document.getElementById('catalog').innerHTML = '<p style="color:red; text-align:center;">PDF yüklənərkən xəta baş verdi.</p>';
      console.error(err);
    });

    // Firebase konfiqurasiya və məhsulları yükləmə
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCSaiU9DguIk47O8LPZ_Oa6StJgHbPqZ6I",
      authDomain: "perfume-8b7f7.firebaseapp.com",
      projectId: "perfume-8b7f7",
      storageBucket: "perfume-8b7f7.appspot.com",
      messagingSenderId: "899731999798",
      appId: "1:899731999798:web:750af78287f56d15d41c97"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadProducts(){
      const productList = document.getElementById('product-list');
      productList.innerHTML = '<p style="text-align:center;">Yüklənir...</p>';
      try {
        const querySnapshot = await getDocs(collection(db, "products"));
        if(querySnapshot.empty){
          productList.innerHTML = '<p style="text-align:center;">Məhsul tapılmadı.</p>';
          return;
        }
        productList.innerHTML = '';
        querySnapshot.forEach(docSnap => {
          const data = docSnap.data();
          const div = document.createElement('div');
          div.classList.add('product-card');
          div.textContent = `${data.name || 'Ad yoxdur'} (Kod: ${data.code || '-'})`;
          productList.appendChild(div);
        });
      } catch(e) {
        productList.innerHTML = '<p style="color:red; text-align:center;">Məhsullar yüklənərkən xəta baş verdi.</p>';
        console.error(e);
      }
    }
    loadProducts();

    // AJAX ilə form göndərmə
    const contactForm = document.getElementById('contactForm');
    const successMessage = document.getElementById('successMessage');

    contactForm.addEventListener('submit', e => {
      e.preventDefault();
      const formData = new FormData(contactForm);
      fetch(contactForm.action, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      }).then(response => {
        if(response.ok){
          successMessage.style.color = 'green';
          successMessage.textContent = 'Məktubunuz göndərildi. Təşəkkürlər!';
          contactForm.reset();
        } else {
          throw new Error('Xəta baş verdi');
        }
      }).catch(() => {
        successMessage.style.color = 'red';
        successMessage.textContent = 'Göndərmə zamanı xəta baş verdi.';
      });
    });
  </script>
</body>
</html>
